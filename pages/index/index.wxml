<!--index.wxml - ç²¾è‡´è®¾è®¡ç‰ˆ-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
  <view class="header-section {{hideHeader ? 'hide' : ''}}">
    <view class="main-title">ç« é±¼çš„é«˜æ•ˆåŠ©æ‰‹</view>
    <view class="subtitle">æ ¡å›­èµ„è®¯ï¼Œä¸€æ‰‹æŒæ¡</view>
    <view class="decorative-line"></view>
  </view>
  
  <!-- æ–°é—»æ¥æºåŒºåŸŸ -->
  <view class="news-section card">
    <view class="section-header">
      <view class="section-title">
        <view class="title-icon">ğŸ“°</view>
        <text>æ–°é—»æ¥æº</text>
      </view>
      <view class="update-time" wx:if="{{lastUpdateTime}}">
        <text>ğŸ• {{lastUpdateTime}} æ›´æ–°</text>
      </view>
    </view>
    
    <!-- ç½‘ç«™é€‰æ‹©æ–¹æ¡† -->
    <view class="website-selector">
      <view class="website-boxes">
        <view class="website-box" 
              wx:for="{{websites}}" 
              wx:key="id" 
              bindtap="selectWebsite" 
              data-website="{{item}}" 
              class="{{selectedWebsite && selectedWebsite.id === item.id ? 'selected' : ''}}">
          <view class="box-icon">{{item.type === 'jwc' ? 'ğŸ“' : item.type === 'tw' ? 'ğŸ“¢' : item.type === 'favorites' ? 'â­' : 'ğŸ“°'}}</view>
          <view class="box-content">{{item.type === 'jwc' ? 'æœ¬ç§‘ç”Ÿé™¢' : item.type === 'tw' ? 'æ ¡å›¢å§”' : item.type === 'favorites' ? 'æˆ‘çš„æ”¶è—' : 'æ–‡æ¾œæ–°é—»'}}</view>
          <view class="box-indicator" wx:if="{{selectedWebsite && selectedWebsite.id === item.id}}">âœ…</view>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢ä¸ç­›é€‰ -->
    <view class="filter-bar" wx:if="{{!showFavorites}}">
      <view class="filter-row-inline">
        <view class="filter-item time-filter" bindtap="toggleDaysFilter">â° {{daysFilterOptions[daysFilterIndex]}}</view>
        <view class="search-box-inline">
          <input class="search-input" placeholder="ğŸ” æœç´¢æ ‡é¢˜" bindinput="onSearchInput" value="{{searchQuery}}" />
          <view class="clear-btn" wx:if="{{searchQuery}}" bindtap="clearSearch">âœ•</view>
        </view>
      </view>
    </view>

    <!-- æ–°é—»å†…å®¹åŒºåŸŸ -->
    <view class="news-content-wrapper">
      <!-- æ”¶è—åˆ—è¡¨ -->
      <view class="news-container animate-in" wx:if="{{showFavorites && favoriteList.length > 0}}">
        <view class="news-header">
          <view class="news-count">
            <view class="count-icon">â­</view>
            <text>{{favoriteList.length}} æ¡æ”¶è—</text>
          </view>
          <view class="news-header-actions">
            <view class="font-adjust">
              <view class="font-btn" bindtap="decreaseListFontSize">â–</view>
              <view class="font-btn" bindtap="increaseListFontSize">â•</view>
            </view>
          </view>
        </view>
        <scroll-view scroll-y="true" class="news-scroll">
          <view class="news-item compact" 
                wx:for="{{favoriteList}}" 
                wx:key="id" 
                bindtap="viewNewsDetail" 
                data-news="{{item}}">
            <view class="news-content">
              <view class="news-title" style="font-size: {{listFontSize}}rpx;">{{item.title}}</view>
              <view class="news-meta">
                <view class="news-source-badge">{{item.source}}</view>
                <view class="news-date">{{item.date}}</view>
              </view>
            </view>
            <view class="news-actions">
              <view class="favorite-btn active" catchtap="toggleFavorite" data-news="{{item}}">â­</view>
              <view class="news-arrow">â–¶ï¸</view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- æ”¶è—ä¸ºç©º -->
      <view class="empty-state" wx:if="{{showFavorites && favoriteList.length === 0}}">
        <view class="empty-icon-text">ğŸ“­</view>
        <view class="empty-text">æš‚æ— æ”¶è—å†…å®¹</view>
        <view class="empty-hint">åœ¨æ–°é—»è¯¦æƒ…é¡µç‚¹å‡»æ”¶è—æŒ‰é’®å³å¯æ·»åŠ </view>
      </view>

      <!-- æ–°é—»åˆ—è¡¨ -->
      <view class="news-container animate-in" wx:if="{{!showFavorites && displayNewsList.length > 0 && !loading}}">
        <view class="news-header">
          <view class="news-count">
            <view class="count-icon">ğŸ“‹</view>
            <text>{{displayNewsList.length}} æ¡æ–°é—»</text>
          </view>
          <view class="news-header-actions">
            <view class="font-adjust">
              <view class="font-btn" bindtap="decreaseListFontSize">â–</view>
              <view class="font-btn" bindtap="increaseListFontSize">â•</view>
            </view>
          </view>
        </view>
        <scroll-view scroll-y="true" class="news-scroll">
          <view class="news-item compact {{item.isRead ? 'read' : ''}}" 
                wx:for="{{displayNewsList}}" 
                wx:key="id" 
                bindtap="viewNewsDetail" 
                data-news="{{item}}">
            <view class="news-content">
              <view class="news-title" style="font-size: {{listFontSize}}rpx;">{{item.title}}</view>
              <view class="news-meta">
                <view class="news-source-badge">{{item.source}}</view>
                <view class="news-date">{{item.date}}</view>
                <view class="news-read-badge" wx:if="{{item.isRead}}">âœ… å·²è¯»</view>
              </view>
            </view>
            <view class="news-actions">
              <view class="favorite-btn {{item.isFavorite ? 'active' : ''}}" catchtap="toggleFavorite" data-news="{{item}}">
                {{item.isFavorite ? 'â­' : 'â˜†'}}
              </view>
              <view class="news-arrow">â–¶ï¸</view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- åŠ è½½é®ç½©å±‚ -->
      <view class="loading-overlay" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">â³ åŠ è½½ä¸­...</text>
      </view>

      <!-- é”™è¯¯çŠ¶æ€ -->
      <view class="error-state" wx:if="{{!loading && errorMessage}}">
        <image class="error-image" src="https://lsky.vip.cpolar.cn/i/2026/02/20/6998505679a50.webp" mode="aspectFit"></image>
        <view class="error-text">âŒ {{errorMessage}}</view>
        <button class="retry-btn" bindtap="retryFetch">ğŸ”„ é‡è¯•</button>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!showFavorites && !loading && !errorMessage && displayNewsList.length === 0}}">
        <image class="empty-icon" src="https://lsky.vip.cpolar.cn/i/2026/02/20/699853810c9f4.webp" mode="aspectFit"></image>
        <view class="empty-text">{{selectedWebsite ? 'æœªè·å–åˆ°ç¬¦åˆæ¡ä»¶çš„æ–°é—»' : 'ğŸ‘† ç‚¹å‡»ä¸Šæ–¹ç½‘ç«™è·å–æ–°é—»'}}</view>
        <button class="retry-btn" wx:if="{{selectedWebsite}}" bindtap="retryFetch">ğŸ”„ é‡æ–°è·å–</button>
      </view>
    </view>
  </view>
  
  <!-- é¡µè„š -->
  <view class="footer">
    <text>ç« é±¼çš„é«˜æ•ˆåŠ©æ‰‹ Â© 2026</text>
  </view>
</view>